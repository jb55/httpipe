#!/usr/bin/env node

var program = require('commander');
var request = require('hyperquest');
var utils = require('../lib/utils');
var remote = require('../lib/remote');
var debug = require('debug')('httpipe:post');

program
  .usage("[options] <url>");

program.on('--help', function(){
  console.log('  Examples:');
  console.log();
  console.log('    # pipe to httpipe.io by default');
  console.log('    $ echo "hello world" | httpipe post welcome.txt');
  console.log();
  console.log('    # pipe to any url running the server');
  console.log('    $ httpipe post http://pipe.me.com/file.txt < file.txt');
  console.log();
  console.log('    # curl equivalent');
  console.log('    $ curl -X POST -d@- http://httpipe.io/file.txt < derp.txt');
  console.log();
  process.exit();
});

program.parse(process.argv);

var url = program.args[0];
if (!url) utils.fatal('<url> or httpipe.io/<path> required');

debug("posting to %s", url);

var req = request.post(remote(url))

req.on('response', function(res){
  req.on('data', function(data){
    if (res.statusCode !== 200)
      utils.error(res.statusCode + " " + data);
  });
});

process.stdin.pipe(req);
